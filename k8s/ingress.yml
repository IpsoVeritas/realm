apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: "{{ .INGRESS_NAME }}"
  annotations:
    k8s.brickchain.com/dns: "true"
    kubernetes.io/ingress.allow-http: "false"
    kubernetes.io/tls-acme: "true"
    certmanager.k8s.io/acme-dns01-provider: "clouddns"
    certmanager.k8s.io/acme-challenge-type: "dns01"
spec:
  tls:
  - hosts:
    - "{{ .URL }}"
    secretName: "tls-{{ .URL }}"
  backend:
    serviceName: {{ .SERVICE }}
    servicePort: {{ .PORT }}
  rules:
  - http:
      paths:
      - path: /realm/v2/*
        backend:
            serviceName: {{ .SERVICE }}
            servicePort: {{ .PORT }}
      - path: /realm/v2
        backend:
            serviceName: {{ .SERVICE }}
            servicePort: {{ .PORT }}
      - path: /.well-known/realm/*
        backend:
            serviceName: {{ .SERVICE }}
            servicePort: {{ .PORT }}